{% extends 'base.html' %}
{% block content %}
  <h2>Patient List</h2>

  <form method="GET" action="{{ url_for('view_patients') }}" style="margin-bottom: 18px;">
    <input type="text" name="q" placeholder="Search by name..." value="{{ query }}">
    <button type="submit">Search</button>
    <a href="{{ url_for('add_patient') }}" class="add-btn">+ Add Patient</a>
    <div style="clear:both"></div>
  </form>

  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>DOB</th>
        <th>Gender</th>
        <th>PT Notes</th>
        <th>OT Notes</th>
        <th>Edit</th>
        <th>Delete</th>
      </tr>
    </thead>
    <tbody>
      {% for p in patients %}
        <tr>
          <td>{{ p.name }}</td>
          <td>{{ p.dob.strftime('%Y-%m-%d') }}</td>
          <td>{{ p.gender }}</td>
          <td><a href="{{ url_for('view_pt_notes', patient_id=p.id) }}">View PT Notes</a></td>
          <td><a href="{{ url_for('view_ot_notes', patient_id=p.id) }}">View OT Notes</a></td>
          <td>
            <a href="{{ url_for('edit_patient', patient_id=p.id) }}" class="btn btn-sm btn-primary">Edit</a>
          </td>
          <td>
            <form method="POST" action="{{ url_for('delete_patient', patient_id=p.id) }}" style="display:inline;">
              <button type="submit" class="btn btn-sm btn-danger" onclick="return confirm('Delete this patient? All related notes will also be removed.');">Delete</button>
            </form>
           </td>
         </tr>
       {% else %}
         <tr><td colspan="7">No patients found.</td></tr>
       {% endfor %}
     </tbody>
    </table>
{% endblock %}
